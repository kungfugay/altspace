<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mc.app.repository.GeminiRepository">
<!--    히트맵을 만들기 위한 DB 조회 쿼리 -->
    <select id="selectPopularLocations" resultType="com.mc.app.dto.PopularLocation">
        SELECT
            a.name,
            a.location,
            SUM(a.views) AS total_views,
            COUNT(DISTINCT p.payment_id) AS booking_count,
            AVG(r.grade) AS avg_rating
        FROM accommodations AS a
                 LEFT JOIN payments p ON a.accommodation_id = p.accommodation_id AND p.pay_status = '완료'
                 LEFT JOIN reviews r ON a.accommodation_id = r.accommodation_id
        GROUP BY a.name, a.location
    </select>
</mapper>